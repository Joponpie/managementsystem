<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“ä¸Šæ¶æ’ç¨‹ç®¡ç†ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: #f5f7fa;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .brand-selector {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .brand-selector h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .brand-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,107,107,0.4);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .action-btn.secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78,205,196,0.4);
        }

        .brand-tab {
            padding: 12px 24px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .brand-tab:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .brand-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
        }

        .phase {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .phase-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .phase-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .phase-title h2 {
            font-size: 22px;
            color: #333;
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
        }

        .channel-card {
            background: #f8f9fa;
            padding: 18px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
            transition: all 0.3s ease;
        }

        .channel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .channel-card.online {
            border-left-color: #667eea;
        }

        .channel-card.offline {
            border-left-color: #f093fb;
        }

        .channel-card.group {
            border-left-color: #ffa726;
        }

        .channel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .channel-name {
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .channel-type {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            background: white;
            color: #666;
        }

        .brand-section {
            margin-bottom: 15px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .brand-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .brand-section-header:hover {
            background: #e9ecef;
        }

        .brand-name {
            font-weight: 600;
            font-size: 14px;
            color: #333;
        }

        .sku-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .sku-list.expanded {
            max-height: 800px;
        }

        .sku-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            font-size: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .sku-item:last-child {
            border-bottom: none;
        }

        .sku-item input[type="checkbox"] {
            cursor: pointer;
        }

        .sku-name {
            flex: 1;
            color: #666;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
        }

        .status-indicator.selected {
            background: #4caf50;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .close-btn:hover {
            color: #333;
        }

        .brand-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .brand-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }

        .brand-card-header {
            font-weight: 600;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
            color: #333;
        }

        .select-all-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .select-all-btn:hover {
            background: #5568d3;
        }

        .save-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }

        .material-btn {
            background: #ffa726;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
            width: 100%;
            transition: all 0.3s;
        }

        .material-btn:hover {
            background: #fb8c00;
            transform: translateY(-1px);
        }

        .material-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }

        .material-item {
            background: #fff;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 6px;
            border-left: 3px solid #ffa726;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .material-sku-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .material-sku-name.unselected {
            color: #999;
            font-style: italic;
        }

        /* æ–°å¢: å·²å®Œæˆçš„SKUåç¨±åŠ ä¸Šåˆªé™¤ç·š */
        .material-sku-name.completed {
            text-decoration: line-through;
            color: #999;
        }

        .material-types {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .material-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .material-checkbox:hover {
            background: #e9ecef;
        }

        .material-checkbox input {
            cursor: pointer;
        }

        .material-note {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            resize: vertical;
            min-height: 60px;
        }

        .material-summary {
            background: linear-gradient(135deg, #ffa72620, #ff6b6b10);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .material-summary h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .material-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .material-stat-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }

        .material-stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #ffa726;
        }

        .material-stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: #ffa726;
            border-color: #ffa726;
            color: white;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 13px;
        }

        .summary-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #e0e0e0;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .summary-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .summary-table tr:hover {
            background: #f8f9fa;
        }

        .channel-tag {
            display: inline-block;
            padding: 3px 8px;
            margin: 2px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 11px;
            color: #1976d2;
        }

        .material-tag {
            display: inline-block;
            padding: 2px 6px;
            margin: 2px;
            background: #fff3e0;
            border-radius: 3px;
            font-size: 11px;
            color: #f57c00;
        }

        .price-input {
            width: 100px;
            padding: 6px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
        }

        .price-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .price-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .price-label {
            min-width: 120px;
            font-size: 13px;
            color: #666;
        }

        .export-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: auto;
        }

        .export-btn:hover {
            background: #45a049;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group label {
            font-weight: 600;
            margin-right: 10px;
            color: #666;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .filter-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        /* åˆªé™¤æŒ‰éˆ•æ¨£å¼ */
        .delete-btn {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            margin-left: 10px;
            transition: color 0.2s;
        }
        .delete-btn:hover {
            color: #ee5a52;
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .channels-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }

            .brand-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¦ å•†å“ä¸Šæ¶æ’ç¨‹ç®¡ç†ç³»çµ±</h1>
            <p>4 å€‹å“ç‰Œ Ã— 65 å€‹ SKU Ã— 51 å€‹é€šè·¯</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>ç¸½é€šè·¯æ•¸</h3>
                <div class="number">51</div>
            </div>
            <div class="stat-card">
                <h3>ç·šä¸Šé€šè·¯</h3>
                <div class="number">12</div>
            </div>
            <div class="stat-card">
                <h3>ç·šä¸‹é€šè·¯</h3>
                <div class="number">19</div>
            </div>
            <div class="stat-card">
                <h3>åœ˜è³¼ä¸»</h3>
                <div class="number">20</div>
            </div>
            <div class="stat-card">
                <h3>ç¸½å“ç‰Œæ•¸</h3>
                <div class="number">4</div>
            </div>
            <div class="stat-card">
                <h3>ç¸½ SKU æ•¸</h3>
                <div class="number">65</div>
            </div>
            <div class="stat-card">
                <h3>ä¸Šæ¶å®Œæˆåº¦</h3>
                <div class="number" id="completionRate">0%</div>
            </div>
        </div>

        <div class="brand-selector">
            <h3>ğŸ¯ å“ç‰Œç¯©é¸</h3>
            <div class="brand-tabs">
                <div class="brand-tab active" onclick="filterBrand('all')">å…¨éƒ¨é¡¯ç¤º</div>
                <div class="brand-tab" onclick="filterBrand('iFind')">ğŸ“ iFind (19)</div>
                <div class="brand-tab" onclick="filterBrand('LOHOY')">â˜‚ï¸ LOHOY (31)</div>
                <div class="brand-tab" onclick="filterBrand('HappyNut')">ğŸ¥œ Happy Nut (5)</div>
                <div class="brand-tab" onclick="filterBrand('NETTEC')">ğŸª¥ å„ªæ¨‚ (10)</div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn primary" onclick="openMaterialSummary()">
                ğŸ“‹ ç´ æéœ€æ±‚ç¸½æ•´ç†
            </button>
            <button class="action-btn secondary" onclick="openGlobalPriceManager()">
                ğŸ’° å…¨é€šè·¯åƒ¹æ ¼ç¸½è¦½
            </button>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>é€šè·¯é¡å‹ï¼š</label>
                <button class="filter-btn active" onclick="filterChannelType('all')">å…¨éƒ¨</button>
                <button class="filter-btn" onclick="filterChannelType('online')">ç·šä¸Šé€šè·¯ (12)</button>
                <button class="filter-btn" onclick="filterChannelType('offline')">ç·šä¸‹é€šè·¯ (19)</button>
                <button class="filter-btn" onclick="filterChannelType('group')">åœ˜è³¼ä¸» (20)</button>
            </div>
        </div>

        <div class="material-summary">
            <h3>ğŸ“¸ ç´ æéœ€æ±‚ç¸½è¦½</h3>
            <div class="material-stats">
                <div class="material-stat-item">
                    <div class="material-stat-number" id="totalMaterialNeeded">0</div>
                    <div class="material-stat-label">å¾…è£œç´ æ</div>
                </div>
                <div class="material-stat-item">
                    <div class="material-stat-number" id="totalMaterialComplete">0</div>
                    <div class="material-stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="material-stat-item">
                    <div class="material-stat-number" id="materialProgress">0%</div>
                    <div class="material-stat-label">å®Œæˆåº¦</div>
                </div>
            </div>
        </div>

        <div class="phase">
            <div class="phase-header">
                <div class="phase-title">
                    <span class="phase-badge">ç¬¬ä¸€æ³¢</span>
                    <h2>ç·šä¸Šé€šè·¯</h2>
                </div>
                <span style="color: #666; font-size: 14px;">ğŸ“± å…± 13 å€‹é€šè·¯</span>
            </div>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                ğŸ¯ ç›®æ¨™ï¼šå„å¤§é›»å•†å¹³å°ã€å“ç‰Œå®˜ç¶²ã€å‚ç›´é›»å•†ç­‰ç·šä¸Šé€šè·¯
            </p>
            <div class="channels-grid" id="phase1"></div>
        </div>

        <div class="phase">
            <div class="phase-header">
                <div class="phase-title">
                    <span class="phase-badge">ç¬¬äºŒæ³¢</span>
                    <h2>ç·šä¸‹é€šè·¯</h2>
                </div>
                <span style="color: #666; font-size: 14px;">ğŸª å…± 19 å€‹é€šè·¯</span>
            </div>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                ğŸ¯ ç›®æ¨™ï¼šå¯¦é«”é›¶å”®å•†ã€æ‰¹ç™¼ä»£ç†å•†ã€ç‰¹æ®Šé€šè·¯ç­‰ç·šä¸‹é€šè·¯
            </p>
            <div class="channels-grid" id="phase2"></div>
        </div>

        <div class="phase">
            <div class="phase-header">
                <div class="phase-title">
                    <span class="phase-badge">ç¬¬ä¸‰æ³¢</span>
                    <h2>åœ˜è³¼ä¸»</h2>
                </div>
                <span style="color: #666; font-size: 14px;">ğŸ‘¥ å…± 20 å€‹åœ˜è³¼ä¸»</span>
            </div>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                ğŸ¯ ç›®æ¨™ï¼šå„å¤§åœ˜è³¼ä¸»ã€KOLã€ç¤¾ç¾¤åœ˜è³¼é€šè·¯
            </p>
            <div class="channels-grid" id="phase3"></div>
        </div>
    </div>

    <div class="modal" id="skuModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">é¸æ“‡ä¸Šæ¶å•†å“</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <button class="select-all-btn" onclick="selectAllSKUs()">å…¨é¸æ‰€æœ‰å•†å“</button>
            <div class="brand-grid" id="skuBrandGrid"></div>
            <button class="save-btn" onclick="saveSKUSelection()">å„²å­˜é¸æ“‡</button>
        </div>
    </div>

    <div class="modal" id="materialModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 id="materialModalTitle">ç´ æéœ€æ±‚ç®¡ç†</h2>
                <button class="close-btn" onclick="closeMaterialModal()">Ã—</button>
            </div>
            
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchMaterialTab('needed')">ç¼ºç´ æ (<span id="neededCount">0</span>)</button>
                <button class="tab-btn" onclick="switchMaterialTab('complete')">å·²å®Œæˆ (<span id="completeCount">0</span>)</button>
            </div>

            <div id="materialContent"></div>
            
            <button class="save-btn" onclick="saveMaterialNeeds()">å„²å­˜ç´ æéœ€æ±‚</button>
        </div>
    </div>

    <div class="modal" id="materialSummaryModal">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh;">
            <div class="modal-header">
                <h2>ğŸ“‹ ç´ æéœ€æ±‚ç¸½æ•´ç†</h2>
                <button class="close-btn" onclick="closeMaterialSummary()">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <p style="color: #666;">æ‰€æœ‰é€šè·¯çš„ç´ æéœ€æ±‚å½™æ•´ï¼Œæ–¹ä¾¿è¨­è¨ˆå¸«çµ±ä¸€è£½ä½œ</p>
                <button class="export-btn" onclick="exportMaterialSummary()">åŒ¯å‡º Excel</button>
            </div>
            
            <div id="materialSummaryContent" style="overflow-x: auto;"></div>
        </div>
    </div>

    <div class="modal" id="channelPriceModal">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh;">
            <div class="modal-header">
                <h2 id="channelPriceTitle">é€šè·¯å®šåƒ¹ç®¡ç†</h2>
                <button class="close-btn" onclick="closeChannelPriceManager()">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <p style="color: #666;">è¨­å®šæ­¤é€šè·¯çš„å•†å“å”®åƒ¹å’Œæˆæœ¬</p>
            </div>
            
            <div id="channelPriceContent" style="overflow-y: auto; max-height: 60vh;"></div>
            
            <button class="save-btn" onclick="saveChannelPrices()">å„²å­˜å®šåƒ¹</button>
        </div>
    </div>

    <div class="modal" id="priceModal">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh;">
            <div class="modal-header">
                <h2>ğŸ’° å…¨é€šè·¯åƒ¹æ ¼ç¸½è¦½</h2>
                <button class="close-btn" onclick="closePriceManager()">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <p style="color: #666;">æŸ¥çœ‹æ‰€æœ‰é€šè·¯çš„å®šåƒ¹è¨­å®š</p>
                <button class="export-btn" onclick="exportPriceSummary()">åŒ¯å‡ºåƒ¹æ ¼è¡¨</button>
            </div>
            
            <div id="priceContent" style="overflow: auto;"></div>
        </div>
    </div>

    <script>
        // ====================================================================
        // I. æ ¸å¿ƒåŒ¯å‡ºå·¥å…·å‡½å¼
        // ====================================================================

        function exportTableToCSV(tableId, filename) {
            const tableContainer = document.getElementById(tableId);
            if (!tableContainer) {
                alert('æ‰¾ä¸åˆ°åŒ¯å‡ºè¡¨æ ¼å®¹å™¨ï¼');
                return;
            }
            const table = tableContainer.querySelector('table');
            if (!table) {
                alert('æ‰¾ä¸åˆ°åŒ¯å‡ºè¡¨æ ¼å…§å®¹ï¼');
                return;
            }

            const rows = table.querySelectorAll('tr');
            let csv = [];

            // è™•ç†æ¨™é¡Œè¡Œ (TH)
            const headerRow = rows[0];
            const headerCells = headerRow.querySelectorAll('th');
            let header = [];
            headerCells.forEach(cell => {
                let text = cell.textContent.replace(/(\r\n|\n|\r)/gm, "").trim();
                header.push(text);
            });
            csv.push(header.join(','));

            // è™•ç†è³‡æ–™è¡Œ (TD)
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const cols = row.querySelectorAll('td');
                let rowData = [];

                cols.forEach((col, colIndex) => {
                    let text = '';
                    
                    if (tableId === 'materialSummaryContent') {
                        // ç´ æç¸½æ•´ç†çš„ç‰¹æ®Šè™•ç†
                        if (colIndex === 2) { // éœ€è¦ç´ æ
                            const tags = col.querySelectorAll('.material-tag');
                            text = Array.from(tags).map(tag => tag.textContent).join(';');
                        } else if (colIndex === 3) { // éœ€æ±‚é€šè·¯
                            const tags = col.querySelectorAll('.channel-tag');
                            text = Array.from(tags).map(tag => tag.textContent).join(';');
                        } else {
                            text = col.textContent.replace(/(\r\n|\n|\r)/gm, ' ').replace(/,/, 'ï¼Œ').trim();
                        }
                    } else if (tableId === 'priceTableContent') {
                        // åƒ¹æ ¼ç¸½è¦½çš„ç‰¹æ®Šè™•ç†ï¼šæŠ“å–åƒ¹æ ¼/æˆæœ¬/åˆ©æ½¤
                        const priceDetails = [];
                        col.querySelectorAll('div').forEach(div => {
                            if (div.style.color === 'rgb(153, 153, 153)' || !div.querySelector('strong')) {
                                return;
                            }
                            const cleanText = div.textContent.replace(/(\r\n|\n|\r)/gm, ' ').trim();
                            priceDetails.push(cleanText.replace(/,/g, 'ï¼Œ').replace(/:/g, 'ï¼š'));
                        });
                        text = priceDetails.join(' | ');
                        
                        // é‡å°å‰å…©æ¬„ï¼ˆå“ç‰Œå’ŒSKUï¼‰ä½¿ç”¨ç´”æ·¨æ–‡å­—
                        if (colIndex < 2) {
                            text = col.textContent.replace(/(\r\n|\n|\r)/gm, ' ').replace(/,/g, 'ï¼Œ').trim();
                        } else if (text === '' && col.textContent.includes('æœªä¸Šæ¶')) {
                             text = 'æœªä¸Šæ¶';
                        }
                    } else {
                         // ä¸€èˆ¬æ¬„ä½æ¸…ç†
                        text = col.textContent.replace(/(\r\n|\n|\r)/gm, ' ').replace(/,/, 'ï¼Œ').trim();
                    }
                    
                    rowData.push(`"${text}"`); 
                });
                csv.push(rowData.join(','));
            }

            // å‰µå»º Blob å’Œä¸‹è¼‰é€£çµ (æ”¯æ´ä¸­æ–‡ç·¨ç¢¼)
            const csvFile = new Blob(["\uFEFF", csv.join('\n')], { type: 'text/csv;charset=utf-8;' }); // åŠ å…¥ BOM
            const downloadLink = document.createElement('a');
            
            downloadLink.download = filename;
            downloadLink.href = window.URL.createObjectURL(csvFile);
            downloadLink.style.display = 'none';
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }

        // ====================================================================
        // II. åŸå§‹è³‡æ–™è¨­å®š
        // ====================================================================
        const channels = {
            phase1: [
                { name: 'momoè³¼ç‰©ç¶²', type: 'online' },
                { name: 'PChome 24h', type: 'online' },
                { name: 'iFind å“ç‰Œå®˜ç¶²', type: 'online' },
                { name: 'æ¨‚å¤©å¸‚å ´', type: 'online' },
                { name: 'è¦çš®è³£å ´ A', type: 'online' },
                { name: 'è¦çš®è³£å ´ B', type: 'online' },
                { name: 'è¦çš®è³£å ´ C', type: 'online' },
                { name: 'æœ‰å“å‘³å®˜ç¶²', type: 'online' },
                { name: 'åª½å’ªæ„›', type: 'online' },
                { name: 'Fridayè³¼ç‰©', type: 'online' },
                { name: 'å…¨é›»å•†', type: 'online' },
                { name: 'é…·æ¾å•†åŸ', type: 'online' },
                { name: 'MOåº—å®¶', type: 'online' }
            ],
            phase2: [
                { name: 'ç¾è³£', type: 'offline' },
                { name: 'çœŸæ„›å¤§å¥åº·', type: 'offline' },
                { name: 'ä¸Šç™¼ç§‘æŠ€', type: 'offline' },
                { name: 'åŒ–çŸ³å…ˆç”Ÿ', type: 'offline' },
                { name: 'èŠ±è“®é é›„', type: 'offline' },
                { name: 'å¥½ä¼´æ—…', type: 'offline' },
                { name: 'å“ˆéŸ“å­•åª½å’ª', type: 'offline' },
                { name: 'æ¨‚æ¯”æ¯”', type: 'offline' },
                { name: 'å¯¦èª å…ƒå’Œ', type: 'offline' },
                { name: 'æ¾³åˆ©è³¼', type: 'offline' },
                { name: 'æ‰€ä»¥åœ‹éš›', type: 'offline' },
                { name: 'éŸ“è±†è·¯', type: 'offline' },
                { name: 'èŠ¯äº«åœ‹éš›', type: 'offline' },
                { name: 'ç²¾å¯¦åœ‹éš›', type: 'offline' },
                { name: 'å¥§ä¸–åœ‹éš›', type: 'offline' },
                { name: 'è»’äºˆåœ‹éš›', type: 'offline' },
                { name: 'éˆ¦å¾·', type: 'offline' },
                { name: 'Kenny', type: 'offline' },
                { name: 'é›¨å‚˜ç‹', type: 'offline' }
            ],
            phase3: [
                { name: 'åœ˜è³¼ä¸»-Nai', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-CS Kids', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-DEMY', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-æ¥Šå°èŠ±', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-è˜‡è²', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-CJ Lin', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-é™³ç­ æŸ”', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-å¼µçŠçŠ', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-æ—¥å¸¸ç«¥è‘—', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-ICE', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-å¡æ‹‰Kara', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-å“ˆæ¯”', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-æˆ´æŸ”å…’', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-é ­é ­', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-å®œå¯§', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-Vimy Store', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-Young', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-å°O', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-é›²ç«', type: 'group' },
                { name: 'åœ˜è³¼ä¸»-é›¯é›¯', type: 'group' }
            ]
        };

        const brands = {
            iFind: {
                name: 'iFind å®šä½å™¨',
                icon: 'ğŸ“',
                skus: [
                    'æ³¢ç´‹é»‘+ä¿è­·å¥—(6è‰²é¸1)',
                    'æ³¢ç´‹éŠ€ç°+ä¿è­·å¥—(6è‰²é¸1)',
                    'æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-æ³¢ç´‹é»‘',
                    'æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-æ³¢ç´‹éŠ€ç°',
                    'å°è¡Œæ˜Ÿè¯åxæ¨‚æ¨‚-æ³¢ç´‹é»‘',
                    'å°è¡Œæ˜Ÿè¯åxæ¨‚æ¨‚-æ³¢ç´‹ç°',
                    'å®‰å“ç‰ˆ(é»‘)+ä¿è­·å¥—(6è‰²é¸1)',
                    'å®‰å“ç‰ˆ(ç™½)+ä¿è­·å¥—(6è‰²é¸1)',
                    'æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-(å®‰å“)é»‘',
                    'æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-(å®‰å“)ç™½',
                    'æ³¢ç´‹é»‘+å¯µç‰©ä¿è­·å¥—(10è‰²é¸1)',
                    'æ³¢ç´‹éŠ€ç°+å¯µç‰©ä¿è­·å¥—(10è‰²é¸1)',
                    '(å®‰å“)é»‘+å¯µç‰©ä¿è­·å¥—(10è‰²é¸1)',
                    '(å®‰å“)ç™½+å¯µç‰©ä¿è­·å¥—(10è‰²é¸1)',
                    'ä¸‰éº—é·—è¯å-æ³¢ç´‹é»‘',
                    'ä¸‰éº—é·—è¯å-æ³¢ç´‹éŠ€ç°',
                    'ä¸‰éº—é·—è¯å-(å®‰å“)é»‘',
                    'ä¸‰éº—é·—è¯å-(å®‰å“)ç™½',
                    'iFindä¿è­·å¥—(6è‰²)'
                ]
            },
            LOHOY: {
                name: 'LOHOY ç«¥è¶£åœ“å¤¢å‚˜',
                icon: 'â˜‚ï¸',
                skus: [
                    'ç«¥è¶£åœ“å¤¢å‚˜-å°æé¾', 'ç«¥è¶£åœ“å¤¢å‚˜-å°è€è™', 'ç«¥è¶£åœ“å¤¢å‚˜-å“ˆå›‰èƒ–é”',
                    'ç«¥è¶£åœ“å¤¢å‚˜-èŒç‹—è²åˆ©', 'ç«¥è¶£åœ“å¤¢å‚˜-å‹•ç‰©æ£®æ—', 'ç«¥è¶£åœ“å¤¢å‚˜-è²çˆ¾ç†Š',
                    'ç«¥è¶£åœ“å¤¢å‚˜-èŠæ©ç…', 'ç«¥è¶£åœ“å¤¢å‚˜-æ–¹èˆŸæ´¾å°', 'ç«¥è¶£åœ“å¤¢å‚˜-è’²è‹±é€å¤¢',
                    'ç«¥è¶£åœ“å¤¢å‚˜-ç¬‘å‚²é£›å…”', 'ç«¥è¶£åœ“å¤¢å‚˜-ç•°æƒ³ä¸–ç•Œ', 'ç«¥è¶£åœ“å¤¢å‚˜-è‰åœ°èŠå“‡',
                    'ç«¥è¶£åœ“å¤¢å‚˜-æ©™æ„æ°´è±š', 'ç«¥è¶£åœ“å¤¢å‚˜-å¾®å–µå¾®ç¿¹',
                    'ç«¥è¶£åœ“å¤¢å‚˜-æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-æ³¢åŠ›',
                    'ç«¥è¶£åœ“å¤¢å‚˜-æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-å®‰å¯¶',
                    'ç«¥è¶£åœ“å¤¢å‚˜-æ•‘æ´å°è‹±é›„æ³¢åŠ›è¯å-ç¸½å‹•å“¡',
                    'ç«¥è¶£åœ“å¤¢å‚˜-è¦ªå­å¤©ä¸‹è³´é¦¬è¯å-æ„›å“­å…¬ä¸»',
                    'ç«¥è¶£åœ“å¤¢å‚˜-è¦ªå­å¤©ä¸‹è³´é¦¬è¯å-ç”Ÿæ°£ç‹å­',
                    'ç«¥è¶£åœ“å¤¢å‚˜-å°å…’å­é˜¿ç”¯å’•è¯å-é˜¿ç”¯å’•çš„é£›è¡Œå‚˜',
                    'æ‘ºç–Šåœ“å¤¢å‚˜-å°æé¾', 'æ‘ºç–Šåœ“å¤¢å‚˜-å°è€è™', 'æ‘ºç–Šåœ“å¤¢å‚˜-èŒç‹—è²åˆ©',
                    'æ‘ºç–Šåœ“å¤¢å‚˜-æ–¹èˆŸæ´¾å°', 'æ‘ºç–Šåœ“å¤¢å‚˜-ç¬‘å‚²é£›å…”', 'æ‘ºç–Šåœ“å¤¢å‚˜-è’²è‹±é€å¤¢',
                    'æ‘ºç–Šåœ“å¤¢å‚˜-å‹•ç‰©æ£®æ—', 'æ‘ºç–Šåœ“å¤¢å‚˜-æ£®æ—èšå“‡', 'æ‘ºç–Šåœ“å¤¢å‚˜-å¾®å–µå¾®ç¿¹',
                    'æ‘ºç–Šåœ“å¤¢å‚˜-è¦ªå­å¤©ä¸‹é”å…‹æ¯”è¯å-ç±³ç™½é…ä»¶',
                    'æ‘ºç–Šåœ“å¤¢å‚˜-è¦ªå­å¤©ä¸‹é”å…‹æ¯”è¯å-æ©˜ç´…ç¶“å…¸'
                ]
            },
            HappyNut: {
                name: 'Happy Nut å¤å¨å¤·è±†',
                icon: 'ğŸ¥œ',
                skus: [
                    'æ¾³æ´²å¿«æ¨‚æœç«å±±è±†-å–®åŒ…',
                    'æ¾³æ´²å¿«æ¨‚æœç«å±±è±†-3åŒ…çµ„',
                    'æ¾³æ´²å¿«æ¨‚æœç«å±±è±†-6åŒ…çµ„+(è´ˆ)å“ç‰Œé‡é¤è¢‹',
                    '(å…­å€‹æœˆå…§)æ¾³æ´²å¿«æ¨‚æœç«å±±è±†-å–®åŒ…',
                    '(å…­å€‹æœˆå…§)æ¾³æ´²å¿«æ¨‚æœç«å±±è±†-5åŒ…çµ„'
                ]
            },
            NETTEC: {
                name: 'å„ªæ¨‚å…’ç«¥é›»å‹•ç‰™åˆ·',
                icon: 'ğŸª¥',
                skus: [
                    'å…’ç«¥Uå‹é›»å‹•ç‰™åˆ· é…·æ´›ç±³+è´ˆå“',
                    'å…’ç«¥Uå‹é›»å‹•ç‰™åˆ· å¤§è€³ç‹—+è´ˆå“',
                    'å…’ç«¥Uå‹é›»å‹•ç‰™åˆ· Hello Kitty+è´ˆå“',
                    'å…’ç«¥Uå‹é›»å‹•ç‰™åˆ· ç…å­ç‹+è´ˆå“',
                    'å…’ç«¥Uå‹é›»å‹•ç‰™åˆ· å½­å½­+è´ˆå“',
                    'åŠ åƒ¹è³¼-Uå‹ç‰™åˆ·é ­',
                    'åŠ åƒ¹è³¼-è¬æ¯›ç‰™åˆ·é ­',
                    'åŠ åƒ¹è³¼-è­·é½’æ³¡æ²«ç‰™è†',
                    'å››å…¥Uå‹ç‰™åˆ·é ­',
                    'å››å…¥è¬æ¯›ç‰™åˆ·é ­'
                ]
            }
        };

        let channelData = {};
        let currentChannel = null;
        let activeBrandFilter = 'all';
        let activeChannelTypeFilter = 'all';
        let materialNeeds = {}; // ç´ æéœ€æ±‚æ•¸æ“š
        let currentMaterialTab = 'needed';
        let priceData = {}; // åƒ¹æ ¼æ•¸æ“š

        const materialTypes = [
            { id: 'main', label: 'ä¸»åœ–' },
            { id: 'detail', label: 'æƒ…å¢ƒåœ–' },
            { id: 'size', label: 'å°ºå¯¸åœ–' },
            { id: 'video', label: 'å½±ç‰‡' },
            { id: 'banner', label: 'Banner' },
            { id: 'infographic', label: 'è³‡è¨Šåœ–' }
        ];

        // ====================================================================
        // III. è³‡æ–™åˆå§‹åŒ–èˆ‡å„²å­˜
        // ====================================================================
        
        function initializeData() {
            Object.keys(channels).forEach(phase => {
                channels[phase].forEach(channel => {
                    if (!channelData[channel.name]) {
                        channelData[channel.name] = {};
                        Object.keys(brands).forEach(brandId => {
                            channelData[channel.name][brandId] = brands[brandId].skus.map(() => false);
                        });
                    }
                    
                    // åˆå§‹åŒ–ç´ æéœ€æ±‚æ•¸æ“š
                    if (!materialNeeds[channel.name]) {
                        materialNeeds[channel.name] = {};
                        Object.keys(brands).forEach(brandId => {
                            materialNeeds[channel.name][brandId] = brands[brandId].skus.map(() => ({
                                types: {},
                                note: '',
                                completed: false
                            }));
                        });
                    }
                    
                    // åˆå§‹åŒ–åƒ¹æ ¼æ•¸æ“šï¼ˆæŒ‰é€šè·¯ï¼‰
                    if (!priceData[channel.name]) {
                        priceData[channel.name] = {};
                        Object.keys(brands).forEach(brandId => {
                            priceData[channel.name][brandId] = brands[brandId].skus.map(() => ({
                                price: '',
                                cost: '',
                                note: ''
                            }));
                        });
                    }
                });
            });
            
            loadFromStorage();
        }

        function saveToStorage() {
            try {
                localStorage.setItem('channelDataV3', JSON.stringify(channelData));
                localStorage.setItem('materialNeedsV1', JSON.stringify(materialNeeds));
                localStorage.setItem('priceDataV2', JSON.stringify(priceData));
            } catch (e) {
                console.error('å„²å­˜å¤±æ•—:', e);
            }
        }

        function loadFromStorage() {
            try {
                const data = localStorage.getItem('channelDataV3');
                if (data) {
                    channelData = JSON.parse(data);
                }
                
                const materials = localStorage.getItem('materialNeedsV1');
                if (materials) {
                    materialNeeds = JSON.parse(materials);
                }
                
                const prices = localStorage.getItem('priceDataV2');
                if (prices) {
                    priceData = JSON.parse(prices);
                }
            } catch (e) {
                console.error('è®€å–å¤±æ•—:', e);
            }
        }

        // ====================================================================
        // IV. é€šè·¯å¡ç‰‡èˆ‡ç¯©é¸å™¨
        // ====================================================================
        
        function createChannelCard(channel) {
            const card = document.createElement('div');
            card.className = `channel-card ${channel.type}`;
            card.setAttribute('data-type', channel.type);

            const typeText = {
                'online': 'ç·šä¸Š',
                'offline': 'ç·šä¸‹',
                'group': 'åœ˜è³¼ä¸»'
            }[channel.type];
            
            let selectedCount = 0;
            let totalCount = 0;
            Object.keys(brands).forEach(brandId => {
                if (activeBrandFilter === 'all' || activeBrandFilter === brandId) {
                    const brandData = channelData[channel.name][brandId];
                    selectedCount += brandData.filter(Boolean).length;
                    totalCount += brandData.length;
                }
            });

            card.innerHTML = `
                <div class="channel-header">
                    <span class="channel-name">${channel.name}</span>
                    <span class="channel-type">${typeText}</span>
                </div>
                <div style="margin-top: 10px; padding: 12px; background: white; border-radius: 6px; cursor: pointer;" onclick="openSKUModal('${channel.name}')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 14px; color: #666;">å·²é¸å•†å“</span>
                        <span style="font-size: 18px; font-weight: bold; color: #667eea;">${selectedCount} / ${totalCount}</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 12px; color: #999;">é»æ“Šé¸æ“‡å•†å“ â†’</div>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button class="material-btn" style="flex: 1;" onclick="event.stopPropagation(); openMaterialModal('${channel.name}')">
                        ğŸ“¸ ç´ æéœ€æ±‚
                    </button>
                    <button class="material-btn" style="flex: 1; background: #4ecdc4;" onmouseover="this.style.background='#44a08d'" onmouseout="this.style.background='#4ecdc4'" onclick="event.stopPropagation(); openChannelPriceManager('${channel.name}')">
                        ğŸ’° é€šè·¯å®šåƒ¹
                    </button>
                </div>
            `;

            return card;
        }

        function renderAllChannels() {
            ['phase1', 'phase2', 'phase3'].forEach(phaseId => {
                const container = document.getElementById(phaseId);
                container.innerHTML = '';
                channels[phaseId].forEach(channel => {
                    if (activeChannelTypeFilter === 'all' || activeChannelTypeFilter === channel.type) {
                        container.appendChild(createChannelCard(channel));
                    }
                });
            });
            updateStats();
        }

        function filterBrand(brand) {
            activeBrandFilter = brand;
            document.querySelectorAll('.brand-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            renderAllChannels();
        }

        function filterChannelType(type) {
            activeChannelTypeFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderAllChannels();
        }

        function updateStats() {
            let totalSelected = 0;
            let totalPossible = 0;
            let totalMaterialNeeded = 0;
            let totalMaterialComplete = 0;

            Object.keys(channelData).forEach(channelName => {
                Object.keys(brands).forEach(brandId => {
                    totalSelected += channelData[channelName][brandId].filter(Boolean).length;
                    totalPossible += channelData[channelName][brandId].length;
                    
                    // è¨ˆç®—ç´ æéœ€æ±‚
                    channelData[channelName][brandId].forEach((selected, index) => {
                        const materialData = materialNeeds[channelName][brandId][index];
                        const hasNeeds = Object.keys(materialData.types).some(key => materialData.types[key]) || materialData.note.trim() !== '';
                            
                        if (hasNeeds) {
                            if (materialData.completed) {
                                totalMaterialComplete++;
                            } else {
                                totalMaterialNeeded++;
                            }
                        }
                    });
                });
            });

            const percentage = totalPossible > 0 ? Math.round((totalSelected / totalPossible) * 100) : 0;
            document.getElementById('completionRate').textContent = `${percentage}%`;
            
            // æ›´æ–°ç´ æçµ±è¨ˆ
            document.getElementById('totalMaterialNeeded').textContent = totalMaterialNeeded;
            document.getElementById('totalMaterialComplete').textContent = totalMaterialComplete;
            
            const totalMaterial = totalMaterialNeeded + totalMaterialComplete;
            const materialPercentage = totalMaterial > 0 ? Math.round((totalMaterialComplete / totalMaterial) * 100) : 0;
            document.getElementById('materialProgress').textContent = `${materialPercentage}%`;
        }

        // ====================================================================
        // V. SKU é¸æ“‡æ¨¡æ…‹æ¡†
        // ====================================================================

        function openSKUModal(channelName) {
            currentChannel = channelName;
            document.getElementById('modalTitle').textContent = `${channelName} - é¸æ“‡ä¸Šæ¶å•†å“`;
            
            const grid = document.getElementById('skuBrandGrid');
            grid.innerHTML = '';

            Object.keys(brands).forEach(brandId => {
                if (activeBrandFilter !== 'all' && activeBrandFilter !== brandId) return;

                const brand = brands[brandId];
                const brandCard = document.createElement('div');
                brandCard.className = 'brand-card';

                let skuHTML = `<div class="brand-card-header">${brand.icon} ${brand.name} (${brand.skus.length})</div>`;
                
                brand.skus.forEach((sku, index) => {
                    const checked = channelData[channelName][brandId][index] ? 'checked' : '';
                    skuHTML += `
                        <div class="sku-item">
                            <input type="checkbox" ${checked} 
                                onchange="toggleSKU('${brandId}', ${index})" 
                                id="sku-${brandId}-${index}">
                            <span class="sku-name">${sku}</span>
                        </div>
                    `;
                });

                brandCard.innerHTML = skuHTML;
                grid.appendChild(brandCard);
            });

            document.getElementById('skuModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('skuModal').classList.remove('show');
        }

        function toggleSKU(brandId, index) {
            channelData[currentChannel][brandId][index] = !channelData[currentChannel][brandId][index];
        }

        function selectAllSKUs() {
            Object.keys(brands).forEach(brandId => {
                if (activeBrandFilter !== 'all' && activeBrandFilter !== brandId) return;
                brands[brandId].skus.forEach((_, index) => {
                    channelData[currentChannel][brandId][index] = true;
                    const checkbox = document.getElementById(`sku-${brandId}-${index}`);
                    if (checkbox) checkbox.checked = true;
                });
            });
        }

        function saveSKUSelection() {
            saveToStorage();
            closeModal();
            renderAllChannels();
        }
        
        // ====================================================================
        // VI. ç´ æéœ€æ±‚ç®¡ç†æ¨¡æ…‹æ¡† (å·²ä¿®æ”¹ renderMaterialContent é‚è¼¯ï¼Œå…è¨±æœªå‹¾é¸å¡«å¯«)
        // ====================================================================
        
        // åˆªé™¤å–®ä¸€ SKU çš„ç´ æéœ€æ±‚è¨˜éŒ„
        function deleteMaterialNeed(brandId, skuIndex) {
            if (confirm(`ç¢ºå®šè¦æ¸…é™¤é€šè·¯ ${currentChannel} ä¸‹ ${brands[brandId].skus[skuIndex]} çš„æ‰€æœ‰ç´ æéœ€æ±‚è¨˜éŒ„å—ï¼Ÿ\n(é€™å°‡ç„¡æ³•å¾©åŸ)`)) {
                // é‡è¨­è©² SKU çš„æ‰€æœ‰ç´ æéœ€æ±‚å’Œå‚™è¨»
                materialNeeds[currentChannel][brandId][skuIndex] = {
                    types: {},
                    note: '',
                    completed: false
                };
                saveToStorage();
                renderMaterialContent(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨
                updateStats(); // æ›´æ–°çµ±è¨ˆæ•¸æ“š
            }
        }

        function openMaterialModal(channelName) {
            currentChannel = channelName;
            document.getElementById('materialModalTitle').textContent = `${channelName} - ç´ æéœ€æ±‚ç®¡ç†`;
            currentMaterialTab = 'needed';
            
            // é‡ç½® tab æŒ‰éˆ•
            document.querySelectorAll('#materialModal .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#materialModal .tab-btn')[0].classList.add('active');
            
            renderMaterialContent();
            document.getElementById('materialModal').classList.add('show');
        }

        function closeMaterialModal() {
            document.getElementById('materialModal').classList.remove('show');
        }

        function switchMaterialTab(tab) {
            currentMaterialTab = tab;
            document.querySelectorAll('#materialModal .tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderMaterialContent();
        }

        function renderMaterialContent() {
            const content = document.getElementById('materialContent');
            content.innerHTML = '';
            
            let neededCount = 0;
            let completeCount = 0;
            
            Object.keys(brands).forEach(brandId => {
                const brand = brands[brandId];
                const displaySKUs = []; 
                
                brand.skus.forEach((sku, index) => {
                    const isSelected = channelData[currentChannel][brandId][index];
                    const materialData = materialNeeds[currentChannel][brandId][index];
                    const hasNeeds = Object.keys(materialData.types).some(key => materialData.types[key]) || materialData.note.trim() !== '';

                    // é‚è¼¯ï¼šæ‰€æœ‰ SKU ç„¡æ¢ä»¶é¡¯ç¤ºåœ¨ 'needed' åˆ†é ä¸­ï¼Œä»¥ä¾¿å¡«å¯«éœ€æ±‚ã€‚
                    // åœ¨ 'complete' åˆ†é ä¸­ï¼Œåªé¡¯ç¤ºæœ‰è¨˜éŒ„çš„ SKUã€‚
                    
                    // è¨ˆç®—çµ±è¨ˆæ•¸å­—ï¼ˆä¸è®Šï¼‰
                    if (hasNeeds) {
                        if (materialData.completed) {
                            completeCount++;
                        } else {
                            neededCount++;
                        }
                    }
                    
                    let shouldDisplay = false;
                    
                    if (currentMaterialTab === 'needed') {
                        // åœ¨ã€Œç¼ºç´ æã€åˆ†é ï¼šé¡¯ç¤ºæ‰€æœ‰ SKU
                        shouldDisplay = true;
                    } else if (currentMaterialTab === 'complete' && hasNeeds) {
                        // åœ¨ã€Œå·²å®Œæˆã€åˆ†é ï¼šåªé¡¯ç¤ºæœ‰è¨˜éŒ„çš„ SKU
                        shouldDisplay = true;
                    }

                    if (shouldDisplay) {
                        // æ ¹æ“šç•¶å‰ tab ç¯©é¸
                        if ((currentMaterialTab === 'needed' && !materialData.completed) ||
                            (currentMaterialTab === 'complete' && materialData.completed)) {
                            
                            displaySKUs.push({ index, sku, materialData, isSelected });
                        } else if (currentMaterialTab === 'needed' && !hasNeeds && !materialData.completed) {
                            // åœ¨ã€Œç¼ºç´ æã€é é¢ï¼Œå¦‚æœç›®å‰æ²’æœ‰è¨˜éŒ„ä½†æœªå®Œæˆï¼Œä¹Ÿé¡¯ç¤ºå‡ºä¾†è®“ç”¨æˆ¶å¯ä»¥è¼¸å…¥
                            displaySKUs.push({ index, sku, materialData, isSelected });
                        }
                    }
                });
                
                // å†æ¬¡éæ¿¾ï¼šç¢ºä¿ã€Œå·²å®Œæˆã€é é¢åªé¡¯ç¤ºå·²å®Œæˆçš„é …ç›®ï¼Œä¸”é¿å…é‡è¤‡æ·»åŠ 
                const finalDisplaySKUs = [];
                const addedIndices = new Set();
                
                brand.skus.forEach((sku, index) => {
                    const isSelected = channelData[currentChannel][brandId][index];
                    const materialData = materialNeeds[currentChannel][brandId][index];
                    const hasNeeds = Object.keys(materialData.types).some(key => materialData.types[key]) || materialData.note.trim() !== '';
                    
                    const itemData = { index, sku, materialData, isSelected };
                    const key = `${brandId}-${index}`;
                    
                    if (currentMaterialTab === 'needed') {
                        // é¡¯ç¤ºæ‰€æœ‰æœªå®Œæˆçš„é …ç›®ï¼Œç„¡è«–æ˜¯å¦æœ‰éœ€æ±‚è¨˜éŒ„ï¼ˆå› ç‚ºå¯ä»¥è¼¸å…¥ï¼‰
                        if (!materialData.completed && !addedIndices.has(key)) {
                            finalDisplaySKUs.push(itemData);
                            addedIndices.add(key);
                        }
                    } else if (currentMaterialTab === 'complete') {
                        // é¡¯ç¤ºæ‰€æœ‰å·²å®Œæˆçš„é …ç›®
                        if (materialData.completed && hasNeeds && !addedIndices.has(key)) {
                            finalDisplaySKUs.push(itemData);
                            addedIndices.add(key);
                        }
                    }
                });


                // å¦‚æœæœ‰ SKU éœ€è¦é¡¯ç¤º
                if (finalDisplaySKUs.length > 0) {
                    const brandSection = document.createElement('div');
                    brandSection.className = 'material-section';
                    brandSection.innerHTML = `<h3 style="margin-bottom: 15px; color: #333;">${brand.icon} ${brand.name}</h3>`;
                    
                    finalDisplaySKUs.forEach(({ index, sku, materialData, isSelected }) => {
                        const item = document.createElement('div');
                        item.className = 'material-item';
                        
                        let typesHTML = '<div class="material-types">';
                        materialTypes.forEach(type => {
                            const checked = materialData.types[type.id] ? 'checked' : '';
                            typesHTML += `
                                <label class="material-checkbox">
                                    <input type="checkbox" ${checked} 
                                        onchange="updateMaterialType('${brandId}', ${index}, '${type.id}', this.checked)">
                                    <span>${type.label}</span>
                                </label>
                            `;
                        });
                        typesHTML += '</div>';
                        
                        const completedChecked = materialData.completed ? 'checked' : '';
                        const completedClass = materialData.completed ? 'completed' : '';
                        const unselectedClass = !isSelected ? 'unselected' : ''; 
                        
                        item.innerHTML = `
                            <div class="material-header">
                                <span class="material-sku-name ${completedClass} ${unselectedClass}">${sku} ${!isSelected ? '(æœªä¸Šæ¶)' : ''}</span>
                                <div style="display: flex; align-items: center;">
                                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                        <input type="checkbox" ${completedChecked} 
                                            onchange="updateMaterialCompleted('${brandId}', ${index}, this.checked)">
                                        <span style="font-size: 13px; color: #4caf50;">å·²å®Œæˆ</span>
                                    </label>
                                    <button class="delete-btn" title="æ¸…é™¤æ­¤ SKU çš„ç´ æéœ€æ±‚è¨˜éŒ„" 
                                        onclick="deleteMaterialNeed('${brandId}', ${index})">
                                        &times;
                                    </button>
                                </div>
                            </div>
                            ${typesHTML}
                            <textarea class="material-note" 
                                placeholder="å‚™è¨»èªªæ˜ï¼ˆä¾‹å¦‚ï¼šéœ€è¦ç™½åº•å»èƒŒä¸»åœ–ã€éœ€è¦ 16:9 æ©«ç‰ˆå½±ç‰‡...ï¼‰"
                                onchange="updateMaterialNote('${brandId}', ${index}, this.value)">${materialData.note || ''}</textarea>
                        `;
                        
                        brandSection.appendChild(item);
                    });
                    
                    content.appendChild(brandSection);
                }
            });
            
            // æ›´æ–°è¨ˆæ•¸
            document.getElementById('neededCount').textContent = neededCount;
            document.getElementById('completeCount').textContent = completeCount;
            
            if (content.children.length === 0) {
                content.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">ç›®å‰æ²’æœ‰è³‡æ–™</div>';
            }
        }

        function updateMaterialType(brandId, skuIndex, typeId, checked) {
            materialNeeds[currentChannel][brandId][skuIndex].types[typeId] = checked;
        }

        function updateMaterialNote(brandId, skuIndex, note) {
            materialNeeds[currentChannel][brandId][skuIndex].note = note;
        }

        function updateMaterialCompleted(brandId, skuIndex, completed) {
            materialNeeds[currentChannel][brandId][skuIndex].completed = completed;
            renderMaterialContent(); 
        }

        function saveMaterialNeeds() {
            saveToStorage();
            closeMaterialModal();
            updateStats();
            alert('ç´ æéœ€æ±‚å·²å„²å­˜ï¼');
        }
        
        // ====================================================================
        // VII. ç´ æéœ€æ±‚ç¸½æ•´ç†æ¨¡æ…‹æ¡†
        // ====================================================================

        function openMaterialSummary() {
            const content = document.getElementById('materialSummaryContent');
            let html = '<table class="summary-table" id="materialSummaryTable">'; 
            html += `
                <thead>
                    <tr>
                        <th style="min-width: 150px;">å“ç‰Œ</th>
                        <th style="min-width: 250px;">SKU</th>
                        <th style="min-width: 150px;">éœ€è¦ç´ æ</th>
                        <th style="min-width: 200px;">éœ€æ±‚é€šè·¯</th>
                        <th style="min-width: 300px;">å‚™è¨»èªªæ˜</th>
                        <th style="width: 80px;">ç‹€æ…‹</th>
                    </tr>
                </thead>
                <tbody>
            `;

            // æ”¶é›†æ‰€æœ‰ç´ æéœ€æ±‚
            const summaryData = [];
            
            Object.keys(brands).forEach(brandId => {
                const brand = brands[brandId];
                
                brand.skus.forEach((sku, skuIndex) => {
                    const needsList = [];
                    const channelsList = [];
                    const notesList = [];
                    let isCompleted = true;
                    let hasNeeds = false;
                    
                    Object.keys(channelData).forEach(channelName => {
                        const materialData = materialNeeds[channelName][brandId][skuIndex];
                        const neededTypes = Object.keys(materialData.types).filter(t => materialData.types[t]);
                        
                        // æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç´ æéœ€æ±‚
                        if (neededTypes.length > 0 || materialData.note.trim() !== '') {
                            hasNeeds = true;
                            
                            // æ¨™ç¤ºæœªä¸Šæ¶
                            const isSelected = channelData[channelName][brandId][skuIndex];
                            channelsList.push(channelName + (isSelected ? '' : ' (æœªä¸Šæ¶)')); 
                            
                            neededTypes.forEach(type => {
                                const typeLabel = materialTypes.find(t => t.id === type)?.label || type;
                                if (!needsList.includes(typeLabel)) {
                                    needsList.push(typeLabel);
                                }
                            });
                            
                            if (materialData.note) {
                                notesList.push(`${channelName}: ${materialData.note}`);
                            }
                            
                            if (!materialData.completed) {
                                isCompleted = false;
                            }
                        }
                    });
                    
                    if (hasNeeds) {
                        summaryData.push({
                            brandName: brand.name,
                            brandIcon: brand.icon,
                            sku,
                            needs: needsList,
                            channels: channelsList,
                            notes: notesList,
                            completed: isCompleted
                        });
                    }
                });
            });

            // æ¸²æŸ“è¡¨æ ¼
            if (summaryData.length === 0) {
                html += '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #999;">ç›®å‰æ²’æœ‰ç´ æéœ€æ±‚</td></tr>';
            } else {
                summaryData.forEach(item => {
                    const statusColor = item.completed ? '#4caf50' : '#ff9800';
                    const statusText = item.completed ? 'âœ“ å®Œæˆ' : 'å¾…è£½ä½œ';
                    
                    html += `
                        <tr>
                            <td><strong>${item.brandIcon} ${item.brandName}</strong></td>
                            <td>${item.sku}</td>
                            <td>
                                ${item.needs.map(n => `<span class="material-tag">${n}</span>`).join('')}
                            </td>
                            <td>
                                ${item.channels.map(c => `<span class="channel-tag" style="${c.includes('(æœªä¸Šæ¶)') ? 'background: #fbe9e7; color: #d32f2f;' : ''}">${c}</span>`).join('')}
                            </td>
                            <td style="font-size: 12px; color: #666;">
                                ${item.notes.join('<br>')}
                            </td>
                            <td style="color: ${statusColor}; font-weight: 600;">${statusText}</td>
                        </tr>
                    `;
                });
            }

            html += '</tbody></table>';
            content.innerHTML = html;
            document.getElementById('materialSummaryModal').classList.add('show');
        }

        function closeMaterialSummary() {
            document.getElementById('materialSummaryModal').classList.remove('show');
        }

        function exportMaterialSummary() {
            exportTableToCSV('materialSummaryContent', 'å•†å“ç´ æéœ€æ±‚ç¸½æ•´ç†.csv');
        }
        
        // ====================================================================
        // VIII. åƒ¹æ ¼ç®¡ç†æ¨¡æ…‹æ¡† (å·²ä¿®å¾©åƒ¹æ ¼ç¸½è¦½é¡¯ç¤ºé‚è¼¯)
        // ====================================================================

        function openGlobalPriceManager() {
            openPriceManager();
        }

        function openPriceManager() {
            const content = document.getElementById('priceContent');
            
            // å…ˆé¡¯ç¤ºåˆ†é æŒ‰éˆ•
            let html = `
                <div class="tab-buttons" style="margin-bottom: 20px;">
                    <button class="tab-btn active" onclick="switchPriceTab('online')">ç·šä¸Šé€šè·¯ (13)</button>
                    <button class="tab-btn" onclick="switchPriceTab('offline')">ç·šä¸‹é€šè·¯ (19)</button>
                    <button class="tab-btn" onclick="switchPriceTab('group')">åœ˜è³¼ä¸» (20)</button>
                </div>
                <div id="priceTableContent"></div>
            `;
            
            content.innerHTML = html;
            document.getElementById('priceModal').classList.add('show');
            
            // é è¨­é¡¯ç¤ºç·šä¸Šé€šè·¯
            switchPriceTab('online');
        }

        function switchPriceTab(channelType) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const buttons = document.querySelectorAll('#priceContent .tab-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if ((btn.textContent.includes('ç·šä¸Š') && channelType === 'online') ||
                    (btn.textContent.includes('ç·šä¸‹') && channelType === 'offline') ||
                    (btn.textContent.includes('åœ˜è³¼') && channelType === 'group')) {
                    btn.classList.add('active');
                }
            });
            
            // å–å¾—è©²é¡å‹çš„é€šè·¯
            const filteredChannels = [];
            Object.keys(channels).forEach(phase => {
                channels[phase].forEach(channel => {
                    if (channel.type === channelType) {
                        filteredChannels.push(channel.name);
                    }
                });
            });
            
            // ç”Ÿæˆè¡¨æ ¼
            let tableHTML = '<div style="overflow-x: auto;"><table class="summary-table">';
            tableHTML += `
                <thead>
                    <tr>
                        <th style="min-width: 120px; position: sticky; left: 0; background: #f8f9fa; z-index: 11;">å“ç‰Œ</th>
                        <th style="min-width: 200px; position: sticky; left: 120px; background: #f8f9fa; z-index: 11;">SKU</th>
            `;
            
            tableHTML += filteredChannels.map(ch => `<th style="min-width: 150px;">${ch}<br>(å®šåƒ¹è³‡è¨Š)</th>`).join('');
            tableHTML += '</tr></thead><tbody>';
            
            let hasData = false;
            
            // éæ­·æ‰€æœ‰å“ç‰Œ
            ['iFind', 'LOHOY', 'HappyNut', 'NETTEC'].forEach(brandId => {
                if (!brands[brandId]) return;
                
                const brand = brands[brandId];
                
                brand.skus.forEach((sku, skuIndex) => {
                    hasData = true;
                    tableHTML += `
                        <tr>
                            <td style="position: sticky; left: 0; background: white; z-index: 10;"><strong>${brand.icon} ${brand.name}</strong></td>
                            <td style="position: sticky; left: 120px; background: white; z-index: 10;">${sku}</td>
                    `;
                    
                    // é¡¯ç¤ºç•¶å‰é¡å‹å„é€šè·¯çš„åƒ¹æ ¼
                    filteredChannels.forEach(channelName => {
                        const selected = channelData[channelName] && 
                                       channelData[channelName][brandId] && 
                                       channelData[channelName][brandId][skuIndex];
                        const priceInfo = priceData[channelName] && 
                                        priceData[channelName][brandId] && 
                                        priceData[channelName][brandId][skuIndex] || 
                                        { price: '', cost: '', note: '' };

                        // æª¢æŸ¥æ˜¯å¦æœ‰å¡«å¯«åƒ¹æ ¼æˆ–æˆæœ¬
                        const hasPriceData = priceInfo.price.trim() !== '' || priceInfo.cost.trim() !== '';

                        if (selected || hasPriceData) { // åªè¦å‹¾é¸ OR æœ‰åƒ¹æ ¼è³‡æ–™å°±é¡¯ç¤º
                            const price = parseFloat(priceInfo.price) || 0;
                            const cost = parseFloat(priceInfo.cost) || 0;
                            const profit = (price - cost).toFixed(0);
                            const profitColor = profit > 0 ? '#4caf50' : (profit < 0 ? '#ff6b6b' : '#999');
                            const margin = price > 0 ? 
                                ((price - cost) / price * 100).toFixed(1) : '-';
                            
                            const backgroundStyle = selected ? '#fffef0' : '#f8f8f8'; // æœªå‹¾é¸ä½†æœ‰åƒ¹æ ¼æ•¸æ“šæ™‚ï¼ŒèƒŒæ™¯ç¨æš—
                            
                            tableHTML += `
                                <td style="font-size: 12px; background: ${backgroundStyle};">
                                    ${!selected ? `<div style="color: #d32f2f; font-weight: 600; margin-bottom: 4px;">æœªä¸Šæ¶</div>` : ''}
                                    <div style="margin-bottom: 4px;"><strong>å”®ï¼š</strong>${priceInfo.price || '-'} å…ƒ</div>
                                    <div style="margin-bottom: 4px;"><strong>æˆæœ¬ï¼š</strong>${priceInfo.cost || '-'} å…ƒ</div>
                                    <div style="color: ${profitColor}; margin-bottom: 4px;"><strong>åˆ©æ½¤ï¼š</strong>${profit} å…ƒ</div>
                                    <div style="color: ${profitColor};"><strong>æ¯›åˆ©ï¼š</strong>${margin}%</div>
                                    ${priceInfo.note ? `<div style="color: #999; font-size: 11px; margin-top: 4px; border-top: 1px solid #e0e0e0; padding-top: 4px;">${priceInfo.note}</div>` : ''}
                                </td>
                            `;
                        } else {
                            tableHTML += '<td style="color: #ccc; text-align: center; background: #fafafa;">ç„¡æ•¸æ“š</td>'; // æœªä¸Šæ¶ä¸”ç„¡æ•¸æ“š
                        }
                    });
                    
                    tableHTML += '</tr>';
                });
            });
            
            tableHTML += '</tbody></table></div>';
            
            const tableContent = document.getElementById('priceTableContent');
            tableContent.innerHTML = tableHTML;
        }

        function exportPriceSummary() {
            exportTableToCSV('priceTableContent', 'å…¨é€šè·¯åƒ¹æ ¼ç¸½è¦½.csv');
        }

        function closePriceManager() {
            document.getElementById('priceModal').classList.remove('show');
        }
        
        // å–®ä¸€é€šè·¯å®šåƒ¹ç®¡ç†
        function openChannelPriceManager(channelName) {
            currentChannel = channelName;
            document.getElementById('channelPriceTitle').textContent = `${channelName} - é€šè·¯å®šåƒ¹ç®¡ç†`;
            
            const content = document.getElementById('channelPriceContent');
            let html = '';

            // éæ­·æ‰€æœ‰å“ç‰Œ
            Object.keys(brands).forEach(brandId => {
                const brand = brands[brandId];
                
                // é–‹å§‹å“ç‰Œå€å¡Š
                html += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            ${brand.icon} ${brand.name}
                        </h3>
                `;

                // éæ­·æ‰€æœ‰ SKU
                brand.skus.forEach((sku, index) => {
                    const isSelected = channelData[channelName][brandId][index];
                    const prices = priceData[channelName][brandId][index];
                    const price = parseFloat(prices.price) || 0;
                    const cost = parseFloat(prices.cost) || 0;
                    const profit = (price - cost).toFixed(0);
                    const profitColor = profit > 0 ? '#4caf50' : (profit < 0 ? '#ff6b6b' : '#999');
                    
                    const sectionStyle = isSelected ? 'background: #fff;' : 'background: #f9f9f9; opacity: 0.7;';
                    const statusBadge = isSelected ? 
                        '<span style="background: #4caf50; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; margin-left: 10px;">âœ“ å·²ä¸Šæ¶</span>' :
                        '<span style="background: #ccc; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; margin-left: 10px;">æœªä¸Šæ¶</span>';
                    
                    html += `
                        <div class="price-section" id="price-section-${brandId}-${index}" style="${sectionStyle}">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #333;">
                                ${sku}
                                ${statusBadge}
                            </div>
                            <div class="price-row">
                                <span class="price-label">å”®åƒ¹ï¼š</span>
                                <input type="number" class="price-input" placeholder="0" 
                                    value="${prices.price || ''}"
                                    oninput="updateChannelPrice('${channelName}', '${brandId}', ${index}, 'price', this.value)">
                                <span style="color: #999;">å…ƒ</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label">æˆæœ¬ï¼ˆå«ç¨…ï¼‰ï¼š</span>
                                <input type="number" class="price-input" placeholder="0"
                                    value="${prices.cost || ''}"
                                    oninput="updateChannelPrice('${channelName}', '${brandId}', ${index}, 'cost', this.value)">
                                <span style="color: #999;">å…ƒ</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label">åˆ©æ½¤ï¼š</span>
                                <span style="font-size: 18px; font-weight: bold; color: ${profitColor};" id="profit-${brandId}-${index}">${profit} å…ƒ</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label">å‚™è¨»ï¼š</span>
                                <input type="text" style="flex: 1; padding: 6px; border: 1px solid #e0e0e0; border-radius: 4px;" 
                                    placeholder="ä¾‹å¦‚ï¼šä¿ƒéŠ·åƒ¹ã€æœƒå“¡åƒ¹ç­‰"
                                    value="${prices.note || ''}"
                                    onchange="updateChannelPrice('${channelName}', '${brandId}', ${index}, 'note', this.value)">
                            </div>
                        </div>
                    `;
                });

                html += '</div>'; // çµæŸå“ç‰Œå€å¡Š
            });
            
            if (!html) {
                html = '<div style="text-align: center; padding: 40px; color: #999;">æ­¤é€šè·¯å°šæœªé¸æ“‡å•†å“</div>';
            }

            content.innerHTML = html;
            document.getElementById('channelPriceModal').classList.add('show');
        }

        function closeChannelPriceManager() {
            document.getElementById('channelPriceModal').classList.remove('show');
        }

        function updateChannelPrice(channelName, brandId, skuIndex, priceType, value) {
            priceData[channelName][brandId][skuIndex][priceType] = value;
            
            // å³æ™‚æ›´æ–°åˆ©æ½¤é¡¯ç¤º
            const prices = priceData[channelName][brandId][skuIndex];
            const price = parseFloat(prices.price) || 0;
            const cost = parseFloat(prices.cost) || 0;
            const profit = (price - cost).toFixed(0);
            const profitColor = profit > 0 ? '#4caf50' : (profit < 0 ? '#ff6b6b' : '#999');
            
            const profitDisplay = document.getElementById(`price-section-${brandId}-${skuIndex}`).querySelector('.price-row:nth-child(4) span:last-child');
            if (profitDisplay) {
                profitDisplay.textContent = `${profit} å…ƒ`;
                profitDisplay.style.color = profitColor;
            }
        }

        function saveChannelPrices() {
            saveToStorage();
            closeChannelPriceManager();
            alert('å®šåƒ¹å·²å„²å­˜ï¼');
        }

        function closePriceManager() {
            document.getElementById('priceModal').classList.remove('show');
        }

        function filterBrand(brand) {
            activeBrandFilter = brand;
            document.querySelectorAll('.brand-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            renderAllChannels();
        }

        function filterChannelType(type) {
            activeChannelTypeFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderAllChannels();
        }

        // åˆå§‹åŒ–
        initializeData();
        renderAllChannels();

        // é»æ“Š modal å¤–éƒ¨é—œé–‰
        document.getElementById('skuModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('materialModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMaterialModal();
            }
        });

        document.getElementById('materialSummaryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMaterialSummary();
            }
        });

        document.getElementById('channelPriceModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeChannelPriceManager();
            }
        });

        document.getElementById('priceModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePriceManager();
            }
        });
    </script>
</body>
</html>
